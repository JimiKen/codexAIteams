# 前端工程师文档（Codex AI Teams）

## 1. 前端范围
- 技术栈：Python + PySide6（桌面 GUI）。
- 主入口：`src/codex_ai_teams/ui/main_window.py`
- 目标：提供多 Agent 协作界面、状态可视化与可操作流程闭环。

## 2. 页面结构
- 导航：团队 / 配置 / 日志 / 文件 / 终端（左侧菜单 + 右侧 `QStackedWidget`）。
- 团队页：
  - 团队成员横向 badge（含中文角色）。
  - Agent 表格：Agent、角色、状态、执行日志。
  - 团队对话：目标选择（全体/单成员）、历史区、输入区、发送按钮。
- 配置页：
  - Bridge 参数表单。
  - Agent 参数表格（7 列）。
  - 保存配置按钮。
- 日志页：筛选下拉 + CSV 导出 + 日志表格。
- 文件页：工作路径输入/选择 + 文件树。
- 终端页：命令输入 + 运行 + 输出面板。

## 3. 状态管理与事件流
- 事件总线：`EventBus`（`agent_updated/agent_log/terminal_output/command_finished/dialog_finished`）。
- 团队对话流程：
  - 输入消息后触发 `send_team_message`。
  - 目标可为 `__all__` 或单 Agent。
  - 发送时禁用发送按钮，任务结束后恢复。
  - 每个 Agent 通过 `agent_log` 持续更新行内日志，通过 `agent_updated` 更新最终状态与回复摘要。
- 状态颜色：
  - normal：绿色 `#2ecc71`
  - error：红色 `#ff4d4f`

## 4. 关键交互约束
- 输入快捷键：`Enter` 发送、`Shift+Enter` 换行（`eventFilter`）。
- 团队输入为空时弹窗阻断提交。
- 终端命令为空时不执行。
- 文件页切换路径时同步更新文件树根节点。
- i18n：内置 `zh/en` 文案字典，切换语言后统一刷新控件文案。

## 5. 前端侧已知问题
- `MainWindow` 类职责较重（页面构建、状态管理、业务调度耦合）。
- 团队页日志列仅保留最近 12 行，长任务可读性受限。
- 终端页使用一次性执行，不是持续流式输出体验。
- 配置表格缺少前端输入校验（如温度非数值时仅在保存时失败）。

## 6. FE 下一步优先级
1. 拆分 UI 组件与业务控制器，降低 `MainWindow` 复杂度。
2. 增加配置页即时校验与错误高亮，减少保存失败弹窗。
3. 终端页改为增量流式输出（stdout/stderr 实时显示）。
4. 团队页增强日志可视化（展开详情、复制、自动滚动控制）。
5. 增补 UI 回归清单（语言切换、快捷键、并发状态刷新）。

## 7. FE 验收点
- 5 页面可正常切换，深色主题一致。
- 团队页可稳定群发/单发，状态和日志实时可见。
- 配置页编辑后可保存并刷新运行时。
- 日志页筛选与 CSV 导出可用。
- 文件页目录树与路径切换正确。
- 终端页命令执行完成后按钮恢复可点击。
